package com.revworkforce.dao;

import java.sql.PreparedStatement;
import java.sql.ResultSet;

import com.revworkforce.util.DBUtil;

public class NotificationDAO {

    public ResultSet getNotifications(int empId) throws Exception {

        String sql =
            "SELECT MESSAGE, CREATED_AT " +
            "FROM NOTIFICATION " +
            "WHERE EMP_ID=? " +
            "ORDER BY CREATED_AT DESC";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        return ps.executeQuery();
    }

    public ResultSet getUnreadNotifications(int empId) throws Exception {

        String sql =
            "SELECT MESSAGE " +
            "FROM NOTIFICATION " +
            "WHERE EMP_ID=? AND IS_READ='N'";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        return ps.executeQuery();
    }

    public void markAsRead(int empId) throws Exception {

        String sql =
            "UPDATE NOTIFICATION SET IS_READ='Y' WHERE EMP_ID=?";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        ps.executeUpdate();
    }
}
