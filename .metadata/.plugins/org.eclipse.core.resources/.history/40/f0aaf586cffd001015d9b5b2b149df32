package com.revwokforce.test;

package com.revworkforce.service;

import static org.mockito.Mockito.*;

import java.sql.Date;

import org.junit.Before;
import org.junit.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import com.revworkforce.dao.LeaveDAO;

public class LeaveServiceTest {

    @Mock
    private LeaveDAO leaveDAO;

    private LeaveService leaveService;

    @Before
    public void setUp() {
        MockitoAnnotations.initMocks(this);
        leaveService = new LeaveService(leaveDAO);
    }

    // ================= VIEW BALANCE =================

    @Test
    public void testViewLeaveBalance() throws Exception {
        leaveService.viewLeaveBalance(101);
        verify(leaveDAO).viewLeaveBalance(101);
    }

    // ================= APPLY LEAVE =================

    @Test
    public void testApplyLeaveSuccess() throws Exception {
        Date start = Date.valueOf("2025-02-01");
        Date end   = Date.valueOf("2025-02-05");

        leaveService.applyLeave(101, 1, start, end, "Vacation");

        verify(leaveDAO).applyLeave(101, 1, start, end, "Vacation");
    }

    @Test(expected = Exception.class)
    public void testApplyLeaveInvalidDates() throws Exception {
        Date start = Date.valueOf("2025-02-10");
        Date end   = Date.valueOf("2025-02-05");

        leaveService.applyLeave(101, 1, start, end, "Invalid");
    }

    // ================= VIEW LEAVES =================

    @Test
    public void testViewMyLeaves() throws Exception {
        leaveService.viewMyLeaves(101);
        verify(leaveDAO).viewMyLeaves(101);
    }

    @Test
    public void testViewHolidays() throws Exception {
        leaveService.viewHolidays();
        verify(leaveDAO).viewHolidays();
    }

    // ================= CANCEL LEAVE =================

    @Test
    public void testCancelLeave() throws Exception {
        leaveService.cancelLeave(201, 101);
        verify(leaveDAO).cancelLeave(201, 101);
    }

    // ================= MANAGER ACTIONS =================

    @Test
    public void testViewTeamLeaveRequests() throws Exception {
        leaveService.viewTeamLeaveRequests(301);
        verify(leaveDAO).viewTeamLeaveRequests(301);
    }

    @Test
    public void testApproveLeave() throws Exception {
        leaveService.approveLeave(401, "Approved");
        verify(leaveDAO).approveOrRejectLeave(401, "APPROVED", "Approved");
    }

    @Test
    public void testRejectLeave() throws Exception {
        leaveService.rejectLeave(401, "Rejected");
        verify(leaveDAO).approveOrRejectLeave(401, "REJECTED", "Rejected");
    }
}
