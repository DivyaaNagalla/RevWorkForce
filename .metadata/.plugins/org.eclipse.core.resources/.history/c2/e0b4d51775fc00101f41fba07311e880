package com.revworkforce.dao;

import java.sql.*;
import com.revworkforce.model.Employee;
import com.revworkforce.util.DBUtil;

public class EmployeeDAO {

    public Employee login(int empId, String password) throws Exception {

        String sql =
          "SELECT EMP_ID, NAME, EMAIL, STATUS, PASSWORD_STATUS " +
          "FROM EMPLOYEE WHERE EMP_ID=? AND PASSWORD=?";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        ps.setString(2, password);

        ResultSet rs = ps.executeQuery();

        if (rs.next()) {
            Employee e = new Employee();
            e.setEmpId(rs.getInt("EMP_ID"));
            e.setName(rs.getString("NAME"));
            e.setEmail(rs.getString("EMAIL"));
            e.setStatus(rs.getString("STATUS"));
            e.setPasswordStatus(rs.getString("PASSWORD_STATUS"));
            return e;
        }
        return null;
    }

    public void updatePassword(int empId, String newPwd) throws Exception {

        String sql =
          "UPDATE EMPLOYEE SET PASSWORD=?, PASSWORD_STATUS='CHANGED' WHERE EMP_ID=?";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setString(1, newPwd);
        ps.setInt(2, empId);
        ps.executeUpdate();
    }
}
