package com.revworkforce.dao;

import java.sql.PreparedStatement;
import java.sql.ResultSet;

import com.revworkforce.model.Employee;
import com.revworkforce.util.DBUtil;

public class EmployeeDAO {

    public Employee login(int empId, String password) throws Exception {

        String sql =
            "SELECT E.EMP_ID, E.NAME, E.EMAIL, E.STATUS, E.FIRST_LOGIN, " +
            "E.PHONE_NO, E.ADDRESS, E.EMERGENCY_CONTACT, " +
            "M.NAME AS MANAGER_NAME " +
            "FROM EMPLOYEE E " +
            "LEFT JOIN EMPLOYEE M ON E.MANAGER_ID = M.EMP_ID " +
            "WHERE E.EMP_ID=? AND E.PASSWORD=?";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        ps.setString(2, password);

        ResultSet rs = ps.executeQuery();

        if (rs.next()) {
            Employee emp = new Employee();
            emp.setEmpId(rs.getInt("EMP_ID"));
            emp.setName(rs.getString("NAME"));
            emp.setEmail(rs.getString("EMAIL"));
            emp.setStatus(rs.getString("STATUS"));
            emp.setFirstLogin(rs.getString("FIRST_LOGIN"));
            emp.setPhone(rs.getString("PHONE_NO"));
            emp.setAddress(rs.getString("ADDRESS"));
            emp.setEmergencyContact(rs.getString("EMERGENCY_CONTACT"));
            emp.setManagerName(rs.getString("MANAGER_NAME"));
            return emp;
        }
        return null;
    }

    public void updateProfile(int empId,
                              String phone,
                              String address,
                              String emergency) throws Exception {

        String sql =
            "UPDATE EMPLOYEE " +
            "SET PHONE_NO=?, ADDRESS=?, EMERGENCY_CONTACT=? " +
            "WHERE EMP_ID=?";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setString(1, phone);
        ps.setString(2, address);
        ps.setString(3, emergency);
        ps.setInt(4, empId);

        ps.executeUpdate();
    }
}
