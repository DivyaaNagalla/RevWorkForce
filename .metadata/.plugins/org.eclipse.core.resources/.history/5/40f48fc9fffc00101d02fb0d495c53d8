package com.revworkforce.dao;

import java.sql.PreparedStatement;
import java.sql.ResultSet;

import com.revworkforce.util.DBUtil;

public class NotificationDAO {

    public int getUnreadCount(int empId) throws Exception {

        String sql =
            "SELECT COUNT(*) FROM NOTIFICATION " +
            "WHERE EMP_ID=? AND IS_READ='N'";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        ResultSet rs = ps.executeQuery();
        rs.next();
        return rs.getInt(1);
    }
    public ResultSet viewNotifications(int empId) throws Exception {

        String sql =
            "SELECT NOTIF_ID, MESSAGE " +
            "FROM NOTIFICATION " +
            "WHERE EMP_ID=? " +
            "ORDER BY CREATED_DATE DESC";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        return ps.executeQuery();
    }
    public void markAsRead(int empId) throws Exception {

        String sql =
            "UPDATE NOTIFICATION SET IS_READ='Y' WHERE EMP_ID=?";

        PreparedStatement ps =
            DBUtil.getConnection().prepareStatement(sql);

        ps.setInt(1, empId);
        ps.executeUpdate();
    }
}
