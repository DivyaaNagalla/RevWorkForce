package com.revworkforce.service;

import java.sql.Date;
import java.sql.ResultSet;

import com.revworkforce.dao.EmployeeDAO;
import com.revworkforce.model.Employee;
import com.revworkforce.util.DOBValidator;
import com.revworkforce.util.EmailValidator;
import com.revworkforce.util.PasswordGenerator;
import com.revworkforce.util.PasswordValidator;

public class EmployeeService {

    private EmployeeDAO dao = new EmployeeDAO();
    public Employee login(int empId, String password) throws Exception {

        Employee emp = dao.login(empId, password);

        if (emp == null) {
            throw new Exception("Invalid Employee ID or Password");
        }

        if (!"ACTIVE".equalsIgnoreCase(emp.getStatus())) {
            throw new Exception("Account inactive");
        }

        return emp;
    }
    public void changePassword(int empId,
                               String newPwd,
                               String confirmPwd) throws Exception {

        if (newPwd == null || confirmPwd == null) {
            throw new Exception("Password cannot be empty");
        }

        if (!newPwd.equals(confirmPwd)) {
            throw new Exception("Passwords do not match");
        }

        PasswordValidator.validate(newPwd);
        dao.updatePassword(empId, newPwd);
    }
    public void addEmployee(String name,
                            String email,
                            Date dob) throws Exception {

        if (name == null || name.trim().isEmpty()) {
            throw new Exception("Name cannot be empty");
        }

        EmailValidator.validate(email);
        DOBValidator.validate(dob);

        String tempPwd = PasswordGenerator.generateTempPassword();

        int empId = dao.addEmployee(name, email, dob, tempPwd);

        System.out.println("\n--- Employee Created ---");
        System.out.println("Employee ID   : " + empId);
        System.out.println("Temp Password : " + tempPwd);
    }
    public void assignManager(int empId, int managerId) throws Exception {
        dao.assignManager(empId, managerId);
        System.out.println("Manager assigned successfully");
    }
    public void updateProfile(int empId,
                              String phone,
                              String address,
                              String emergency) throws Exception {

        if (phone == null || phone.length() != 10) {
            throw new Exception("Phone number must be 10 digits");
        }

        if (emergency == null || emergency.length() != 10) {
            throw new Exception("Emergency contact must be 10 digits");
        }

        dao.updateProfile(empId, phone, address, emergency);
        System.out.println("Profile updated successfully");
    }
    public void viewMyTeam(int managerId) throws Exception {

        ResultSet rs = dao.getMyTeam(managerId);
        boolean found = false;

        System.out.println("\n--- My Team ---");

        while (rs.next()) {
            found = true;
            System.out.println(
                rs.getInt("EMP_ID") + " | " +
                rs.getString("NAME") + " | " +
                rs.getString("EMAIL") + " | " +
                rs.getString("PHONE_NO")
            );
        }

        if (!found) {
            System.out.println("No employees assigned to you");
        }
    }
    public void viewBirthdays() throws Exception {
        dao.viewUpcomingBirthdays();
    }
    public void viewAnniversaries() throws Exception {
        dao.viewWorkAnniversaries();
    }

    public void viewEmployeeDirectory() throws Exception {
        dao.viewEmployeeDirectory();
  
    }
}
