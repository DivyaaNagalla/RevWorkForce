package com.revwokforce.test;

import static org.mockito.Mockito.*;

import org.junit.Before;
import org.junit.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import com.revworkforce.dao.PerformanceDAO;

public class PerformanceServiceTest {

    @Mock
    private PerformanceDAO performanceDAO;

    private PerformanceService performanceService;

    @Before
    public void setUp() {
        MockitoAnnotations.initMocks(this);
        performanceService = new PerformanceService(performanceDAO);
    }

    // ================= CREATE REVIEW =================

    @Test
    public void testCreateReviewSuccess() throws Exception {

        performanceService.createReview(
                101,
                2025,
                "Completed modules",
                "Got appreciation",
                "Improve communication",
                4
        );

        verify(performanceDAO).createReview(
                101,
                2025,
                "Completed modules",
                "Got appreciation",
                "Improve communication",
                4
        );
    }

    @Test(expected = Exception.class)
    public void testCreateReviewInvalidRatingLow() throws Exception {
        performanceService.createReview(
                101,
                2025,
                "Work",
                "Achievement",
                "Improve",
                0
        );
    }

    @Test(expected = Exception.class)
    public void testCreateReviewInvalidRatingHigh() throws Exception {
        performanceService.createReview(
                101,
                2025,
                "Work",
                "Achievement",
                "Improve",
                6
        );
    }

    // ================= VIEW REVIEWS =================

    @Test
    public void testViewMyReviews() throws Exception {
        performanceService.viewMyReviews(101);
        verify(performanceDAO).viewMyReviews(101);
    }

    @Test
    public void testViewTeamReviews() throws Exception {
        performanceService.viewTeamReviews(201);
        verify(performanceDAO).viewTeamReviews(201);
    }

    // ================= MANAGER FEEDBACK =================

    @Test
    public void testGiveManagerFeedbackSuccess() throws Exception {

        performanceService.giveManagerFeedback(
                301,
                5,
                "Excellent performance"
        );

        verify(performanceDAO).giveManagerFeedback(
                301,
                5,
                "Excellent performance"
        );
    }

    @Test(expected = Exception.class)
    public void testGiveManagerFeedbackInvalidRating() throws Exception {
        performanceService.giveManagerFeedback(
                301,
                7,
                "Invalid rating"
        );
    }
}

