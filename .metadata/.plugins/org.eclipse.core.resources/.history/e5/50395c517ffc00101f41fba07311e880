package com.revworkforce.service;

import java.time.LocalDate;
import com.revworkforce.dao.LeaveDAO;

public class LeaveService {

    private LeaveDAO dao = new LeaveDAO();

    public void viewLeaveBalance(int empId) {
        dao.getLeaveBalance(empId);
    }

    public void applyLeave(int empId,
                           String type,
                           String from,
                           String to,
                           String reason) throws Exception {

        if (!type.matches("CL|SL|PL"))
            throw new Exception("Invalid leave type");

        LocalDate f = LocalDate.parse(from);
        LocalDate t = LocalDate.parse(to);

        if (t.isBefore(f))
            throw new Exception("To date cannot be before From date");

        long days = t.toEpochDay() - f.toEpochDay() + 1;

        if (!dao.hasSufficientBalance(empId, type, days))
            throw new Exception("Insufficient leave balance");

        dao.applyLeave(empId, type, from, to, reason, days);
    }

    public void viewMyLeaves(int empId) {
        dao.getMyLeaves(empId);
    }

    public void viewHolidays() {
        dao.getHolidays();
    }
}


