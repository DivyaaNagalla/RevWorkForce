package com.revworkforce.service;

import java.sql.Date;
import java.sql.ResultSet;

import com.revworkforce.dao.LeaveDAO;

public class LeaveService {

    private LeaveDAO dao = new LeaveDAO();
    public void applyLeave(int empId,
                           int leaveTypeId,
                           Date startDate,
                           Date endDate,
                           String reason) throws Exception {

        dao.applyLeave(empId, leaveTypeId, startDate, endDate, reason);
        System.out.println("Leave applied successfully (Status: PENDING)");
    }
    public void viewMyLeaves(int empId) throws Exception {

        ResultSet rs = dao.getMyLeaves(empId);
        boolean found = false;

        while (rs.next()) {
            found = true;
            System.out.println(
                rs.getInt("LEAVE_ID") + " | " +
                rs.getDate("START_DATE") + " | " +
                rs.getDate("END_DATE") + " | " +
                rs.getString("STATUS")
            );
        }

        if (!found)
            System.out.println("No leave records found");
    }

    public void viewLeaveBalance(int empId) throws Exception {

        ResultSet rs = dao.getLeaveBalance(empId);
        boolean found = false;

        while (rs.next()) {
            found = true;
            System.out.println(
                rs.getString("LEAVE_NAME") + " : " +
                rs.getInt("AVAILABLE_DAYS")
            );
        }

        if (!found)
            System.out.println("No leave balance available");
    }
    public void cancelLeave(int leaveId) throws Exception {
        dao.cancelLeave(leaveId);
        System.out.println("Leave cancelled successfully");
    }
    public void viewTeamLeaveRequests(int managerId) throws Exception {

        ResultSet rs = dao.getTeamLeaveRequests(managerId);

        while (rs.next()) {
            System.out.println(
                rs.getInt("LEAVE_ID") + " | " +
                rs.getString("NAME") + " | " +
                rs.getDate("START_DATE") + " - " +
                rs.getDate("END_DATE") + " | " +
                rs.getString("STATUS")
            );
        }
    }

    public void viewTeamLeaveCalendar(int managerId) throws Exception {

        ResultSet rs = dao.getTeamLeaveCalendar(managerId);

        while (rs.next()) {
            System.out.println(
                rs.getString("NAME") + " | " +
                rs.getDate("START_DATE") + " - " +
                rs.getDate("END_DATE") + " | " +
                rs.getString("STATUS")
            );
        }
    }

    public void viewTeamLeaveBalance(int managerId) throws Exception {

        ResultSet rs = dao.getTeamLeaveBalance(managerId);

        while (rs.next()) {
            System.out.println(
                rs.getString("NAME") + " | " +
                rs.getString("LEAVE_NAME") + " | " +
                rs.getInt("AVAILABLE_DAYS")
            );
        }
    }

    public void approveOrRejectLeave(int leaveId,
                                     String status,
                                     String comment) throws Exception {

        dao.updateLeaveStatus(leaveId, status, comment);
        System.out.println("Leave " + status + " successfully");
    }

    public void viewHolidays() throws Exception {

        ResultSet rs = dao.getHolidays();
        boolean found = false;

        System.out.println("\n--- Company Holidays ---");

        while (rs.next()) {
            found = true;
            System.out.println(
                rs.getDate("HOLIDAY_DATE") + " | " +
                rs.getString("HOLIDAY_NAME")
            );
        }

        if (!found)
            System.out.println("No holidays configured");
    }
}
