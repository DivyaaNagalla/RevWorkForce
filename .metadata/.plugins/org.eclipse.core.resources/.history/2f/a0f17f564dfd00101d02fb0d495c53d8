package com.revworkforce.service;

import java.sql.ResultSet;
import com.revworkforce.dao.PerformanceDAO;

public class PerformanceService {

    private PerformanceDAO dao = new PerformanceDAO();

  
    public void submitReview(int empId, int year,
                             String kd, String acc,
                             String imp, int rating) throws Exception {

        if (rating < 1 || rating > 5)
            throw new Exception("Rating must be between 1 and 5");

        dao.createReview(empId, year, kd, acc, imp, rating);
        System.out.println(" Performance review submitted successfully");
    }

 
    public void viewMyReviews(int empId) throws Exception {

        ResultSet rs = dao.getMyReviews(empId);
        boolean found = false;

        System.out.println("\n--- My Performance Reviews ---");

        while (rs.next()) {
            found = true;

            System.out.println(
                "Year: " + rs.getInt("REVIEW_YEAR") +
                " | Status: " + rs.getString("STATUS") +
                " | Rating: " + rs.getInt("SELF_RATING")
            );

            String fb = rs.getString("MANAGER_FEEDBACK");
            if (fb != null && !fb.isEmpty()) {
                System.out.println("Manager Feedback: " + fb);
            }

            System.out.println("--------------------------------");
        }

        if (!found)
            System.out.println(" No reviews found");
    }

 
    public void viewMyGoals(int empId) throws Exception {

        ResultSet rs = dao.getMyGoals(empId);
        boolean found = false;

        System.out.println("\n--- My Goals ---");

        while (rs.next()) {
            found = true;

            System.out.println(
                "Goal ID: " + rs.getInt("GOAL_ID") +
                " | Goal: " + rs.getString("GOAL_NAME") +
                " | Progress: " + rs.getInt("PROGRESS") + "%"
            );
        }

        if (!found)
            System.out.println(" No goals assigned");
    }

   
    public void updateGoalProgress(int gid, int prog) throws Exception {

        if (prog < 0 || prog > 100)
            throw new Exception("Progress must be between 0 and 100");

        int rows = dao.updateGoalProgress(gid, prog);

        if (rows > 0)
            System.out.println("Goal progress updated successfully");
        else
            System.out.println(" Invalid Goal ID");
    }

    public void viewManagerFeedback(int empId) throws Exception {

        ResultSet rs = dao.getManagerFeedback(empId);
        boolean found = false;

        System.out.println("\n--- Manager Feedback ---");

        while (rs.next()) {
            found = true;

            System.out.println(
                "Review Year: " + rs.getInt("REVIEW_YEAR")
            );
            System.out.println(
                "Feedback: " + rs.getString("MANAGER_FEEDBACK")
            );
            System.out.println("--------------------------------");
        }

        if (!found)
            System.out.println("No feedback available");
    }

  
    public void viewTeamReviews(int managerId) throws Exception {

        ResultSet rs = dao.getTeamReviews(managerId);
        boolean found = false;

        System.out.println("\n--- Team Performance Reviews ---");

        while (rs.next()) {
            found = true;

            System.out.println(
                "Employee ID: " + rs.getInt("EMP_ID") +
                " | Year: " + rs.getInt("REVIEW_YEAR") +
                " | Rating: " + rs.getInt("SELF_RATING")
            );
        }

        if (!found)
            System.out.println(" No team reviews found");
    }

  
    public void giveFeedback(int reviewId, String fb, int rate) throws Exception {

        if (rate < 1 || rate > 5)
            throw new Exception("Rating must be between 1 and 5");

        int rows = dao.giveFeedback(reviewId, fb, rate);

        if (rows > 0)
            System.out.println(" Feedback submitted successfully");
        else
            System.out.println(" Invalid Review ID");
    }

    public void viewTeamPerformanceSummary(int managerId) throws Exception {

        ResultSet rs = dao.getTeamPerformanceSummary(managerId);
        boolean found = false;

        System.out.println("\n--- Team Performance Summary ---");

        while (rs.next()) {
            found = true;

            System.out.println(
                "Employee ID: " + rs.getInt("EMP_ID") +
                " | Avg Rating: " + rs.getDouble("AVG_RATING")
            );
        }

        if (!found)
            System.out.println(" No team data available");
        public void giveManagerFeedback(int reviewId,
                int rating,
                String feedback) throws Exception {

if (rating < 1 || rating > 5) {
throw new Exception("Rating must be between 1 and 5");
}

dao.giveManagerFeedback(reviewId, rating, feedback);
}

    }
}
